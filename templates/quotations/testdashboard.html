{% extends "base.html" %}

{% block content %}
<div class="row">
  <div class="col-md-6">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Sales</h5>
        <canvas id="sales-chart"></canvas>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card">
			<div class="card-body">
				<h5 class="card-title">Expenses</h5>
				<canvas id="expenses-chart"></canvas>
			</div>
		</div>  </div>
	</div>
	<div class="row mt-3">
		<div class="col-md-6">
			<div class="card">
				<div class="card-body">
					<h5 class="card-title">Sales Table</h5>
					<table id="sales-table" class="table table-striped table-bordered" style="width:100%">
						<thead>
							<tr>
								<th>Date</th>
								<th>Amount</th>
							</tr>
						</thead>
						<tbody>
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<div class="col-md-6">
			<div class="card">
				<div class="card-body">
					<h5 class="card-title">Expenses Table</h5>
					<table id="expenses-table" class="table table-striped table-bordered" style="width:100%">
						<thead>
							<tr>
								<th>Date</th>
								<th>Category</th>
								<th>Amount</th>
							</tr>
						</thead>
						<tbody>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
	{% endblock %}
	{% block javascript %}

	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
	<script src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap4.min.js"></script>
	<script>
		$(document).ready(function() {
			// Set up the sales chart
			var salesChartCtx = document.getElementById('sales-chart').getContext('2d');
			var salesChart = new Chart(salesChartCtx, {
				type: 'bar',
				data: {
					labels: [],
					datasets: [{
						label: 'Sales',
						data: [],
						backgroundColor: 'rgba(54, 162, 235, 0.2)',
						borderColor: 'rgba(54, 162, 235, 1)',
						borderWidth: 1
					}]
				},
				options: {
					scales: {
						yAxes: [{
							ticks: {
								beginAtZero: true
							}
						}]
					}
				}
			});

			// Set up the expenses chart
			var expensesChartCtx = document.getElementById('expenses-chart').getContext('2d');
			var expensesChart = new Chart(expensesChartCtx, {
				type: 'line',
				data: {
					labels: [],
					datasets: [{
						label: 'Expenses',
						data: [],
						backgroundColor: 'rgba(255, 99, 132, 0.2)',
						borderColor: 'rgba(255, 99, 132, 1)',
						borderWidth: 1
					}]
				},
				options: {
					scales: {
						yAxes: [{
							ticks: {
								beginAtZero: true
							}
						}]
					}
				}
			});

			// Set up the sales table
			var salesTable = $('#sales-table').DataTable({
				ajax: {
					url: '/sales/table/',
					dataSrc: ''
				},
				columns: [
					{ data: 'date' },
					{ data: 'amount' }
				]
			});

			// Set up the expenses table
			var expensesTable = $('#expenses-table').DataTable({
				ajax: {
					url: '/expenses/table/',
					dataSrc: ''
					},
					columns: [
					{ data: 'date' },
					{ data: 'category' },
					{ data: 'amount' }
					]
					});

			// Update the charts and tables every 5 seconds
setInterval(function() {
  // Update the sales chart
  $.ajax({
    url: '/sales/chart/',
    success: function(data) {
      salesChart.data.labels = data.labels;
      salesChart.data.datasets[0].data = data.sales;
      salesChart.update();
    }
  });

  // Update the expenses chart
  $.ajax({
    url: '/expenses/chart/',
    success: function(data) {
      expensesChart.data.labels = data.labels;
      expensesChart.data.datasets[0].data = data.expenses;
      expensesChart.update();
    }
  });

  // Update the sales table
  salesTable.ajax.reload();

  // Update the expenses table
  expensesTable.ajax.reload();
}, 5000);
});
</script>
{% endblock %}